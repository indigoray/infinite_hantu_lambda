# 차세대 개발 계획 (개발계획)

## 1. 비전 및 목표
**"단순 봇에서 전문 퀀트 트레이딩 플랫폼으로"**
기존의 `Infinite_hantu`를 리팩토링하는 수준을 넘어, 확장성과 검증 가능성이 확보된 모듈형 아키텍처로 재구축합니다.

- **안정성 (Reliability)**: 24/365 무중단 운영이 가능한 견고한 에러 처리 및 상태 관리.
- **검증 가능성 (Verifiability)**: 모든 전략 변경 사항을 즉시 백테스팅할 수 있는 환경.
- **확장성 (Scalability)**: SOXL 외 다양한 ETF, 주식 및 다양한 전략(무한매수 외)을 플러그인처럼 추가 가능.

## 2. 아키텍처 설계 (Re-Architecture)
기존의 Monolithic 구조를 **Layered Architecture**로 전환합니다.

### A. 도메인 계층 (Core Logic)
> *외부 라이브러리(Streamlit, KIS API) 의존성이 없는 순수 Python 코드*
- **Strategy Interface**: `calculate_signals(market_data) -> orders` 형태의 입출력이 명확한 인터페이스 정의.
- **InfiniteBuyingLogic**: 기존 `InfiniteBuyingStrategy`에서 비즈니스 로직(Star가격 계산, 분할 로직)만 추출하여 순수 함수/클래스로 구현. -> **단위 테스트 가능해짐.**
- **Models**: `Order`, `Position`, `TradeHistory` 등 데이터 모델 정의.

### B. 인프라 계층 (Infrastructure)
- **MarketDataProvider**: KIS API, Yahoo Finance(백테스팅용) 등 데이터 소스 추상화.
- **OrderExecutor**: 실제 주문 실행 및 체결 확인 담당 (Retry 로직 내장).
- **StateRepository**: JSON 파일 또는 SQLite를 사용하여 전략 상태 영구 저장.

### C. 애플리케이션 계층 (Application)
- **TradingEngine**: 전략과 인프라를 연결. 스케줄링, 다중 전략 루프 관리.
- **AlertService**: 텔레그램 등 알림 처리.

### D. 프레젠테이션 계층 (UI)
- **New Dashboard**: Streamlit을 유지하되, 로직을 제거하고 데이터를 받아 표시만 하는 View 역할로 축소.
- **Backtest Viewer**: 백테스팅 결과를 시각적으로 보여주는 페이지 추가.

## 3. 단계별 개발 로드맵 (Roadmap)

### 1단계: 코어 추출 및 테스트 환경 구축 (Foundation)
- [ ] 도메인 모델(Order, Position) 정의
- [ ] `InfiniteBuyingStrategy`에서 순수 로직 분리 (`Logic` 클래스)
- [ ] 분리된 로직에 대한 **단위 테스트(Unit Test)** 작성 (Pytest 활용)
- [ ] 목표: 외부 API 없이 로직만으로 매수/매도 신호가 정확히 나오는지 검증.

### 2단계: 백테스팅 엔진 개발 (Backtesting)
- [ ] `MarketDataProvider` 인터페이스 및 Yahoo Finance 구현체 개발
- [ ] 과거 데이터(OHLCV)를 주입하여 전략을 시뮬레이션하는 `BacktestEngine` 개발
- [ ] 백테스팅 리포트 생성 (수익률, MDD, 승률 등)
- [ ] 목표: 전략 파라미터(분할수, 익절률) 최적화 근거 마련.

### 3단계: 실행 엔진 및 다중 종목 지원 (Execution)
- [ ] 다중 전략/종목을 관리하는 새로운 `TradingEngine` 구현
- [ ] `Config` 구조 개선 (YAML -> Pydantic Model)
- [ ] KIS API 연동부 고도화 (Rate Limit 처리, 소켓 연결 등)
- [ ] 목표: SOXL, TQQQ 동시 운용 및 각각 다른 파라미터 적용 가능.

### 4단계: UI 고도화 (Dashboard)
- [ ] 백테스팅 결과 탭 추가
- [ ] 전체 포트폴리오 현황 대시보드 (종목별 합산)
- [ ] 모바일 친화적 UI 개선

## 4. 기술 스택 제안
- **언어**: Python 3.10+ (Type Hinting 적극 활용)
- **데이터 검증**: Pydantic
- **테스트**: Pytest
- **데이터 분석**: Pandas, Numpy
- **UI**: Streamlit (유지)
- **DB**: SQLite (가벼운 로컬 DB로 전환 권장)

## 5. 결론
이 계획은 기존 코드를 "참고용 레거시"로 취급하고, 핵심 로직부터 다시 쌓아 올리는 방식입니다. 초기 비용은 들지만, 향후 유지보수와 기능 확장에 있어 훨씬 유리한 결과를 가져올 것입니다.
