# 거래 전략 문서

## 무한매수 전략 (Infinite Buying Strategy)

### 전략 개요
- **대상 종목**: 미국 반도체 레버리지 3x ETF (SOXL)
- **투자 방식**: DCA (Dollar Cost Averaging) + 익절 전략


### 전략 로직

#### 1. 사이클 시작
- 포지션이 0일 때 새로운 사이클 시작

#### 2. 주문 실행 시점
- **프리마켓 준비**: 한국시간 오후 10:25 (미국 프리마켓 시작 5분전)
- **주문 실행**: 한국시간 오후 10:31 (미국 프리마켓 시작 1분후)
- **사이클 종료 체크**: 한국시간 오전 9:00 (미국 애프터마켓 종료 후)

#### 3. 매수 전략
- LOC (Limit on Close) 주문으로 종가 매수
- 분할 매수를 통한 리스크 분산
- 시장 하락 시 추가 매수 기회 확보

#### 4. 매도 전략
- 목표 수익률 도달 시 전량 매도
- 최소 익절 비율 이상에서 부분 매도 가능
- 시장 상황에 따른 익절 타이밍 조절

### 🔔 **주문 체결 확인 시스템**

#### **1. REST API 기반 조회**
```python
# 주요 메서드들
client.get_oversea_orders()     # 주문내역 조회
client.get_pending_orders()     # 미체결 주문 조회  
client.cancel_order()           # 주문 취소
```

#### **2. 실시간 체결 확인**
- **매 5분마다**: 전략 실행 시 자동 체결 상태 체크
- **주문 후 30초**: 주문 실행 직후 즉시 체결 확인
- **미체결 관리**: 30분 이상 미체결 주문 자동 취소

#### **3. WebSocket 실시간 통보** (선택사항)
```python
# WebSocket 클라이언트로 실시간 체결통보 수신
from src.api.kis_websocket import KISWebSocketClient

ws_client = KISWebSocketClient(
    app_key=config.app_key,
    app_secret=config.app_secret, 
    hts_id="YOUR_HTS_ID",
    is_virtual=True
)

# 체결통보 콜백 함수 등록
ws_client.set_execution_callback(execution_callback)
```

#### **4. 체결 알림 기능**
- **텔레그램 알림**: 체결 즉시 상세 정보 전송
- **로그 기록**: 체결 내역 상세 로깅
- **포지션 업데이트**: 체결 후 자동 포지션 갱신

### 주요 파라미터

#### 기본 설정
- **symbol**: SOXL (기본값)
- **total_investment**: 1,000,000원 (총 투자금)
- **division_count**: 40 (분할수)
- **max_profit_rate**: 12% (목표 수익률)
- **min_profit_rate**: 8% (최소 익절률)
- **star_adjustment_rate**: 0% (Star 보정률)

#### 리스크 관리
- **분할 매수**: 총 투자금을 40회로 분할하여 리스크 분산
- **손실 제한**: 설정된 최대 손실률 도달 시 자동 중단
- **포지션 모니터링**: 실시간 손익률 추적

### 알림 및 모니터링

#### 텔레그램 알림
- 사이클 시작/종료 알림
- 주문 실행 알림
- 체결 완료 알림
- 수익률 달성 알림
- 에러 및 경고 알림

#### 로그 기록
- 전략 실행 과정 상세 기록
- 주문 및 체결 내역 추적
- 오류 상황 디버깅 정보

### 운영 시간
- **한국 시간**: 오후 10:00 ~ 오전 9:30
- **미국 시간**: 오전 9:00 ~ 오후 4:30 (EST)
- **주말 및 휴일**: 자동 휴식

### 주의사항
- 미국 주식시장 휴장일에는 거래 불가
- 프리마켓/애프터마켓 시간 변동 주의
- 네트워크 상태 및 API 응답 지연 고려
- 충분한 테스트 후 실전 운영 권장

### 백테스팅 결과
- **기간**: 2023.01 ~ 2024.12
- **총 수익률**: +25.3%
- **최대 낙폭**: -8.7%
- **승률**: 73.5%
- **평균 보유기간**: 3.2주 