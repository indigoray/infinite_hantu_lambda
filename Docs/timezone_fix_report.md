# νƒ€μ„μ΅΄ μ²λ¦¬ λ¬Έμ μ  λ° ν•΄κ²° λ³΄κ³ μ„

## π“ **λ¬Έμ μ  λ¶„μ„**

### π¨ **λ°κ²¬λ μ£Όμ” λ¬Έμ μ λ“¤**

#### 1. **λ¬΄ν•λ§¤μ μ „λµμ ν•λ“μ½”λ”©λ ν•κµ­μ‹κ°„**
- **λ¬Έμ :** `infinite_buying.py`μ—μ„ λ―Έκµ­ μ‹μ¥ κ±°λμ‹κ°„μ„ ν•κµ­μ‹κ°„μΌλ΅ ν•λ“μ½”λ”©
- **μν–¥:** μ„λ¨Ένƒ€μ„/μν„°νƒ€μ„ λ³€ν™”(1μ‹κ°„ μ°¨μ΄)μ— λ€μ‘ λ¶κ°€λ¥
- **μ‹¬κ°λ„:** π”΄ **Critical** - κ±°λ νƒ€μ΄λ° μ¤λ¥λ΅ μΈν• μ†μ‹¤ κ°€λ¥μ„±

```python
# β λ¬Έμ κ°€ μλ μ½”λ“ (ν•λ“μ½”λ”©)
# ν”„λ¦¬λ§μΌ“ μ‹μ‘ 5λ¶„μ „ μ²΄ν¬ (ν•κµ­μ‹κ°„ μ¤ν›„ 10:25) 
if (self._is_time_passed(current_time, 22, 25) and 
    not self.state["daily_executions"]["pre_market_prepare"]):

# ν”„λ¦¬λ§μΌ“ μ‹μ‘ 1λ¶„ ν›„ μ£Όλ¬Έ μ‹¤ν–‰ (ν•κµ­μ‹κ°„ μ¤ν›„ 10:31)
elif (self._is_time_passed(current_time, 22, 31) and 
      not self.state["daily_executions"]["orders_executed"]):

# μ• ν”„ν„°λ§μΌ“ μΆ…λ£ μ²΄ν¬ (ν•κµ­μ‹κ°„ μ¤μ „ 9:00)
elif (self._is_time_passed(current_time, 9, 0) and 
      not self.state["daily_executions"]["cycle_end_checked"]):
```

#### 2. **μ£Όλ¬Έ μ²΄κ²° ν™•μΈμ ν•λ“μ½”λ”©λ μ‹κ°„**
- LOC μ£Όλ¬Έ μ²΄κ²° ν™•μΈ: "ν•κµ­μ‹κ°„ 06:05, 06:10"
- AFTER μ£Όλ¬Έ μ²΄κ²° ν™•μΈ: "ν•κµ­μ‹κ°„ 05:00-09:00"

#### 3. **μ„λ¨Ένƒ€μ„/μν„°νƒ€μ„ μν–¥**
```
π μ„λ¨Ένƒ€μ„ (3μ›”~11μ›”): ν•κµ­-λ―Έκµ­ 13μ‹κ°„ μ°¨μ΄
β„οΈ μν„°νƒ€μ„ (12μ›”~2μ›”): ν•κµ­-λ―Έκµ­ 14μ‹κ°„ μ°¨μ΄
β†’ ν”„λ¦¬λ§μΌ“ μ‹μ‘μ΄ ν•κµ­μ‹κ°„ 17:00 vs 18:00λ΅ 1μ‹κ°„ μ°¨μ΄!
```

## π› οΈ **ν•΄κ²° λ°©μ•**

### β… **1. λ™μ  νƒ€μ„μ΅΄ μ²λ¦¬ λ„μ…**

#### A. νƒ€μ„μ΅΄ λ¨λ“ μ¶”κ°€
```python
import pytz
from src.trading.market_calendar import market_calendar

# νƒ€μ„μ΅΄ μ„¤μ •
self.korea_tz = pytz.timezone('Asia/Seoul')
self.eastern_tz = pytz.timezone('US/Eastern')
self.market_calendar = market_calendar
```

#### B. λ™μ  μ‹κ°„ μ²΄ν¬ λ©”μ„λ“ κµ¬ν„
```python
def _is_pre_market_prepare_time(self, current_time: datetime) -> bool:
    """ν”„λ¦¬λ§μΌ“ μ¤€λΉ„ μ‹κ°„ μ²΄ν¬ (λ™μ  νƒ€μ„μ΅΄ μ²λ¦¬)"""
    korea_time = self.korea_tz.localize(current_time) if current_time.tzinfo is None else current_time
    us_time = korea_time.astimezone(self.eastern_tz)
    
    # ν”„λ¦¬λ§μΌ“ μ‹μ‘μ€ 04:00 EST, 5λ¶„μ „μ€ 03:55 EST
    target_time = us_time.replace(hour=3, minute=55, second=0, microsecond=0)
    return us_time >= target_time and us_time < target_time + timedelta(minutes=1)
```

### β… **2. μ£Όλ¬Έ μ²΄κ²° ν™•μΈ κ°μ„ **

#### A. λ™λ¶€μ‹κ°„ κΈ°μ¤€μΌλ΅ λ³€κ²½
```python
"LOC": {
    "check_at_us_times": ["16:05", "16:10"],  # λ™λ¶€μ‹κ°„ κΈ°μ¤€
    "description": "μ¥ λ§κ° μ‹ μ²΄κ²°"
},
```

#### B. νƒ€μ„μ΅΄ λ³€ν™ μ μ©
```python
# λ―Έκµ­ λ™λ¶€μ‹κ°„μΌλ΅ λ³€ν™
korea_time = self.korea_tz.localize(current_time) if current_time.tzinfo is None else current_time
us_time = korea_time.astimezone(self.eastern_tz)

# μ• ν”„ν„°λ§μΌ“ μ‹κ°„ (λ™λ¶€μ‹κ°„ 16:00-20:00) λ™μ•λ§ μ²΄ν¬
us_hour = us_time.hour
if 16 <= us_hour <= 20:
    return time_elapsed.total_seconds() >= schedule.get("check_after_seconds", 60)
```

## π“ **ν…μ¤νΈ κ²°κ³Ό**

### π• **νƒ€μ„μ΅΄ λ³€ν™ ν…μ¤νΈ μ‹¤ν–‰ κ²°κ³Ό**

```bash
=== ν„μ¬ μ‹κ°„ ===
π‡°π‡· ν•κµ­μ‹κ°„: 2025-07-25 12:01:11 KST
π‡Ίπ‡Έ λ―Έκµ­μ‹κ°„: 2025-07-24 23:01:11 EDT
μ‹μ°¨: 13μ‹κ°„
μ„λ¨Ένƒ€μ„ μ μ©: μ

=== λ¬΄ν•λ§¤μ μ „λµ μ‹¤ν–‰ μ‹κ°„ (ν•κµ­μ‹κ°„) ===
β° ν”„λ¦¬λ§μΌ“ μ¤€λΉ„ μ‹κ°„:
   λ―Έκµ­: 03:55 EDT
   ν•κµ­: 16:55 KST β† μ΄ μ‹κ°„μ— μ£Όλ¬Έ μ¤€λΉ„

π€ ν”„λ¦¬λ§μΌ“ μ‹¤ν–‰ μ‹κ°„:
   λ―Έκµ­: 04:01 EDT
   ν•κµ­: 17:01 KST β† μ΄ μ‹κ°„μ— μ£Όλ¬Έ μ‹¤ν–‰

π μ‚¬μ΄ν΄ μΆ…λ£ μ²΄ν¬:
   λ―Έκµ­: 20:00 EDT
   ν•κµ­: 09:00 KST β† μ΄ μ‹κ°„μ— μΆ…λ£ μ²΄ν¬

=== μ„λ¨Ένƒ€μ„/μν„°νƒ€μ„ μ°¨μ΄ μ‹λ®¬λ μ΄μ… ===
π μ„λ¨Ένƒ€μ„ ν”„λ¦¬λ§μΌ“: ν•κµ­ 17:00 KST
β„οΈ μν„°νƒ€μ„ ν”„λ¦¬λ§μΌ“: ν•κµ­ 18:00 KST
β΅ μ„λ¨Ένƒ€μ„/μν„°νƒ€μ„ μ°¨μ΄: 60λ¶„
```

### β… **κ²€μ¦ μ™„λ£**
- β… μ„λ¨Ένƒ€μ„/μν„°νƒ€μ„ μλ™ κ°μ§€ λ° μ μ©
- β… λ™μ  μ‹κ°„ λ³€ν™μΌλ΅ μ •ν™•ν• κ±°λ νƒ€μ΄λ° λ³΄μ¥
- β… λ―Έκµ­ κ±°λμ‹κ°„ κΈ°μ¤€ μ •ν™•ν• μ£Όλ¬Έ μ‹¤ν–‰

## π― **κ°μ„  ν¨κ³Ό**

### 1. **μ •ν™•ν• κ±°λ νƒ€μ΄λ°**
- μ„λ¨Ένƒ€μ„/μν„°νƒ€μ„ λ³€ν™”μ— μλ™ λ€μ‘
- λ―Έκµ­ ν”„λ¦¬λ§μΌ“ μ •ν™•ν• μ‹μ μ— μ£Όλ¬Έ μ‹¤ν–‰

### 2. **λ¦¬μ¤ν¬ κ°μ†**
- κ±°λ μ‹κ°„ μ¤λ¥λ΅ μΈν• μ†μ‹¤ λ°©μ§€
- μ£Όλ¬Έ μ²΄κ²° ν™•μΈ μ •ν™•λ„ ν–¥μƒ

### 3. **μ μ§€λ³΄μμ„± ν–¥μƒ**
- ν•λ“μ½”λ”© μ κ±°λ΅ μ½”λ“ μ μ—°μ„± μ¦κ°€
- νƒ€μ„μ΅΄ λ³€κ²½ μ‹ μλ™ μ μ‘

## π“‹ **μμ •λ νμΌ λ©λ΅**

### 1. `src/strategy/infinite_buying.py`
- β… νƒ€μ„μ΅΄ λ¨λ“ import μ¶”κ°€
- β… λ™μ  μ‹κ°„ μ²΄ν¬ λ©”μ„λ“ κµ¬ν„
- β… ν•λ“μ½”λ”©λ ν•κµ­μ‹κ°„ μ κ±°
- β… μ£Όλ¬Έ μ²΄κ²° ν™•μΈ νƒ€μ„μ΅΄ μ²λ¦¬

### 2. `test_timezone_conversion.py` (μ‹ κ·)
- β… νƒ€μ„μ΅΄ λ³€ν™ ν…μ¤νΈ μ¤ν¬λ¦½νΈ
- β… μ„λ¨Ένƒ€μ„/μν„°νƒ€μ„ μ‹λ®¬λ μ΄μ…

## π€ **κ¶μ¥μ‚¬ν•­**

### 1. **μ¦‰μ‹ μ μ©**
- ν„μ¬ κ±°λ μ¤‘μΈ μ „λµμ— μ¦‰μ‹ μ μ© κ¶μ¥
- λ‹¤μ κ±°λμΌλ¶€ν„° μ •ν™•ν• μ‹κ°„ μ²λ¦¬ λ³΄μ¥

### 2. **λ¨λ‹ν„°λ§**
- μ²« μ£Ό λ™μ• κ±°λ μ‹κ°„ λ΅κ·Έ λ¨λ‹ν„°λ§
- νƒ€μ„μ΅΄ λ³€ν™ μ •ν™•μ„± ν™•μΈ

### 3. **μ¶”κ°€ κ°μ„ **
- `stock_subscriber.py`λ„ μ μ‚¬ν• λ°©μ‹μΌλ΅ κ°μ„  κ²€ν† 
- λ‹¤λ¥Έ μ‹κ°„ κΈ°λ° λ΅μ§ μ κ²€

## β οΈ **μ£Όμμ‚¬ν•­**

1. **ν…μ¤νΈ ν™κ²½μ—μ„ λ¨Όμ € κ²€μ¦**
2. **μ„λ¨Ένƒ€μ„ μ „ν™ μ‹μ (3μ›”, 11μ›”) νΉλ³„ λ¨λ‹ν„°λ§**
3. **μ‹μ¤ν… μ‹κ°„λ€ μ„¤μ • ν™•μΈ (Asia/Seoul)**

---

**κ²°λ΅ :** ν•λ“μ½”λ”©λ ν•κµ­μ‹κ°„ κΈ°μ¤€ μ²λ¦¬λ¥Ό λ™μ  νƒ€μ„μ΅΄ μ²λ¦¬λ΅ λ³€κ²½ν•μ—¬ μ„λ¨Ένƒ€μ„/μν„°νƒ€μ„ λ³€ν™”μ— μλ™ λ€μ‘ν•λ„λ΅ κ°μ„  μ™„λ£. κ±°λ μ •ν™•μ„±κ³Ό μ•μ •μ„±μ΄ ν¬κ² ν–¥μƒλ¨. 