# 현재 상황 분석 보고서 (현재상황)

## 1. 프로젝트 개요
**Infinite_hantu**는 "라오어의 무한매수 법"을 자동화한 주식 트레이딩 시스템입니다. 한국투자증권(KIS) API를 사용하여 미국 ETF(주로 SOXL, TQQQ)를 대상으로 매매를 수행합니다.

- **핵심 목표**: 감정에 휘둘리지 않는 기계적인 분할 매수/매도 (DCA + Value Rebalancing)
- **주요 기술**: Python, Streamlit (UI), RxPy (이벤트), SQLite/JSON (데이터 저장)

## 2. 문서 및 규칙 분석
### .cursor/rules & Documentation
- **규칙 정의**: `.cursor/rules/InfiniteBuyingStrategy.mdc`에 전략 로직이 상세히 기술되어 있습니다. (T<=20 vs T>20 매수 로직, Star 가격 계산, 익절 로직 등)
- **개발 가이드**: `api.mdc`, `app개발규칙.mdc` 등이 존재하나, 최신 코드와의 일치 여부는 검증이 필요합니다.
- **설계 문서**: `TradingStrategy.md`, `Application_design.md` 등이 존재하며 전반적으로 문서화 상태는 양호한 편입니다.

## 3. 소스 코드 구현 상태
### 구조 (Architecture)
- **UI**: `main.py` (Streamlit) - 대시보드 역할. 상태 모니터링 및 제어.
- **엔진**: `TradingEngine` (Thread 기반) - 스케줄링 및 전략 실행 담당.
- **전략**: `InfiniteBuyingStrategy` - 핵심 로직. 상태 관리, 파라미터 계산, 주문 생성/실행을 모두 포함.
- **API**: `KISClient` - 한국투자증권 REST API 래퍼.
- **이벤트**: `EventBus` - 컴포넌트 간 비동기 통신.

### 구현된 기능 (Developed Features)
1. **무한매수 전략 로직**:
   - `_calculate_parameters`: 진행률, Star가격, 익절가 계산 로직 구현됨.
   - `_create_buy/sell_orders`: 시나리오별(T<=20, T>20, 30% 하락 시 추가매수) 주문 생성 구현됨.
   - `_execute_orders`: 텔레그램 승인 프로세스를 포함한 주문 실행 로직 존재.
2. **트레이딩 엔진**:
   - 다중 전략 등록 가능 구조.
   - 스케줄러(`schedule` 라이브러리)를 이용한 주기적 실행 (기본 1분/5분).
   - `StockSubscriber`를 통한 시세 모니터링 시도 흔적 있음.
3. **상태 관리**:
   - JSON 파일 기반 (`states/strategy_state_*.json`)의 상태 저장 및 복구.
   - 백업 및 원자적 저장(Atomic Save) 시도.
4. **UI (Streamlit)**:
   - 현재 포지션, 진행률, 로그, 거래 내역 테이블 표시.
   - 수동 전략 시작/중지 버튼.

### 미구현 또는 불완전한 부분 (Wait/To-Do)
1. **백테스팅 (Backtesting)**: README에 `[ ]`로 표시됨. 과거 데이터를 통한 전략 검증 기능 부재.
2. **다중 종목 동시 운용**: 구조적으로는 가능해 보이나, 실질적인 테스팅 부족 및 UI 지원 미흡 가능성.
3. **웹소켓 (WebSocket)**: 실시간 체결 통보가 코드 일부에 주석이나 미사용 클래스로 존재할 가능성 (문서상 '선택사항/TODO'로 언급).
4. **성과 분석**: 기본적인 테이블은 있으나 심도 있는 시각화(수익률 그래프 등) 부족.

## 4. 코드 품질 1차 진단
- **복잡도**: `InfiniteBuyingStrategy` 클래스가 매우 비대함 (God Class 경향). 로직/상태/통신이 혼재되어 유지보수 어려움 예상.
- **예외 처리**: API 호출 실패 등에 대한 기본적인 try-except 처리는 되어 있음.
- **테스트**: `test/` 디렉토리가 존재하나 커버리지가 낮아 보임 (단위 테스트 부족).

## 5. 결론
프로젝트는 **핵심 전략 로직이 구현되어 실행 가능한 상태(MVP)** 로 보입니다. 하지만 장기적인 안정성과 확장(백테스팅, 다중 종목)을 위해서는 리팩토링과 구조 개선이 필요합니다.
